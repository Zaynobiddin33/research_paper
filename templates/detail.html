{% extends "base.html" %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'main/css/detail.css' %}">

    <!-- Bootstrap & Font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>


{% endblock %}

{% block content %}

    <!-- MAIN -->
    <main class="container">


        <!-- Header -->
        <header class="paper-header">
            <h1 class="paper-title">{{ paper.title }}</h1>
            <p class="paper-meta">{{ paper.owner.first_name }} {{ paper.owner.last_name }} 路 {{ paper.organization }} 路
                Yuklangan {{ paper.published_at }} 路 {{ paper.pages }} sahifa 路 <span class="text-muted">Estimated read: 12 min</span>
            </p>
        </header>

        <!-- Body: main content + sidebar -->
        <section class="paper-body">

            <!-- CONTENT (left / top) -->
            <article class="content-card" role="article" aria-labelledby="paper-title">
                <h2 id="paper-title" class="h5 visually-hidden">Paper content</h2>

                <!-- Abstract -->
                <div class="mb-3">
                    <h3 class="mb-2" style="font-size:1.05rem; font-weight:700;">Hulosa</h3>
                    <p class="paper-content" style="margin-top:6px;">
                        {{ paper.summary }}
                    </p>
                </div>

                <!-- PDF viewer (desktop) -->

                <!-- Full text / sections preview -->
                <div class="mt-4">
                    <h3 style="font-size:1.02rem; font-weight:700; margin-bottom:10px;">Kirish</h3>
                    <p class="paper-content">
                        {{ paper.intro }}
                    </p>

                    <h4 style="font-size:1rem; font-weight:700; margin-top:18px;">Iqtiboslar</h4>
                    <ol style="line-height:1.6; margin-top:8px; color:#333">
                        <li>{{ paper.citations }}</li>
                    </ol>
                </div>

                <!-- Actions (download, cite) -->
                <div class="d-flex flex-wrap gap-2 align-items-center mt-4">
                    <a class="download-btn" href="{{ paper.file.url }}" download="{{ paper.title }}.pdf"
                       aria-label="Download paper PDF">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             style="flex-shrink:0" viewBox="0 0 16 16" aria-hidden="true">
                            <path d="M.5 9.9a.5.5 0 0 1 .5-.5h3.5V1.5a.5.5 0 0 1 1 0v7.9h3.5a.5.5 0 0 1 .35.85l-4 4a.5.5 0 0 1-.7 0l-4-4A.5.5 0 0 1 .5 9.9z"/>
                        </svg>
                        PDF'ni yuklash
                    </a>
                    <button class="small-btn" data-bs-toggle="modal" data-bs-target="#citeModal">Sitata olish</button>
                </div>
            </article>

            <!-- SIDEBAR (right / below on small screens) -->
            <aside class="meta-card" aria-labelledby="meta-heading">
                <h3 id="meta-heading" style="font-size:1.02rem; font-weight:700; margin-bottom:8px;">Paper details</h3>

                <div class="meta-grid" role="list">

                    <div class="meta-label">Avtor</div>
                    <div class="meta-value" style="display:flex; align-items:center; gap:8px;">
                        {% if paper.owner.avatar %}
                            <img src="{{ paper.owner.avatar.url }}"
                                 alt="{{ paper.owner.first_name }} {{ paper.owner.last_name }}"
                                 style="width:36px; height:36px; border-radius:50%; object-fit:cover; border:1px solid #ddd;">
                        {% else %}
                            <img id="avatarPreview" src='https://placehold.co/800x600?text=





                                    {{ paper.owner.first_name|default:"?"|slice:":1"|upper }}{{ paper.owner.last_name|default:"?"|slice:":1"|upper }}'
                                 alt="{{ paper.owner.first_name }} {{ paper.owner.last_name }}"
                                 style="width:36px; height:36px; border-radius:50%; object-fit:cover; border:1px solid #ddd;">
                        {% endif %}

                        <span>{{ paper.owner.first_name }} {{ paper.owner.last_name }}</span>
                    </div>

                    <div class="meta-label">Organizatsiya</div>
                    <div class="meta-value">{{ paper.organization }}</div>

                    <div class="meta-label">Nash etilgan sana</div>
                    <div class="meta-value">{{ paper.published_at }}</div>

                    <div class="meta-label">Sahiflar</div>
                    <div class="meta-value">{{ paper.pages }}ta</div>

                    <!-- Tags row spans both columns -->
                    <div class="meta-tags">
                        <div class="meta-label"
                             style="min-width:0; color:var(--muted); font-size:0.89rem; padding-right:0;">Kalit so'zlar
                        </div>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            {% for tag in tags %}
                                <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Actions row spans both columns -->
                    <div class="meta-actions">
                        <a class="download-btn" href="{{ paper.file.url }}" download="{{ paper.title }}.pdf"
                           aria-label="Download paper PDF (sidebar)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor"
                                 viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M.5 9.9a.5.5 0 0 1 .5-.5h3.5V1.5a.5.5 0 0 1 1 0v7.9h3.5a.5.5 0 0 1 .35.85l-4 4a.5.5 0 0 1-.7 0l-4-4A.5.5 0 0 1 .5 9.9z"/>
                            </svg>
                            Yuklab olish
                        </a>
                    </div>

                </div>
            </aside>

        </section>

    </main>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <!-- Citation Modal -->

    <!-- Modal -->
    <div class="modal fade" id="citeModal" tabindex="-1" aria-labelledby="citeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="citeModalLabel">Sitata olish (Harvard texnikasi)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
        <textarea id="citationText" class="form-control" rows="4" readonly>
{{ paper.owner.last_name }}, {{ paper.owner.first_name }}. ({{ paper.published_at.year }}). {{ paper.title }}.
        </textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-primary rounded-pill" id="copyCitation">Nusxalash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS (if not already included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="{% static 'main/js/detail.js' %}"></script>
{% endblock %}